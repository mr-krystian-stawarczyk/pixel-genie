############################
# âœ… BUILD SETTINGS
############################
[build]
  command = "npm run build"
  publish = ".next"

  [build.environment]
    NODE_VERSION = "20"
    NEXT_TELEMETRY_DISABLED = "1"
    NPM_FLAGS = "--legacy-peer-deps"
    TZ = "Europe/Berlin"
    # âœ… zwiÄ™ksza cache buildÃ³w Next.js
    NETLIFY_USE_YARN_CACHE = "true"

############################
# âœ… FUNCTIONS
############################
[functions]
  directory = "netlify/functions"
  node_bundler = "esbuild"
  external_node_modules = ["@resvg/resvg-js", "satori"]
  included_files = ["public/**/*"]

############################
# âœ… REDIRECTS (STATIC EXPORT)
############################
# Blog posts
[[redirects]]
  from = "/tips/*"
  to = "/tips/:splat/index.html"
  status = 200

# Sitemap â€“ directly accessible
[[redirects]]
  from = "/sitemap.xml"
  to = "/sitemap.xml"
  status = 200

# Prevent access to restricted paths
[[redirects]]
  from = "/cgi/*"
  to = "/404"
  status = 403

[[redirects]]
  from = "/rootDesc.xml*"
  to = "/404"
  status = 403

[[redirects]]
  from = "/loginMsg.js"
  to = "/404"
  status = 403

############################
# âœ… SECURITY HEADERS
############################
[[headers]]
  for = "/*"
  [headers.values]
    Strict-Transport-Security = "max-age=31536000; includeSubDomains; preload"
    X-Frame-Options = "SAMEORIGIN"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"
    Permissions-Policy = "geolocation=(), camera=(), microphone=(), payment=(), usb=()"
    Cross-Origin-Resource-Policy = "same-origin"
    Cross-Origin-Embedder-Policy = "require-corp"
    Cross-Origin-Opener-Policy = "same-origin"
    X-DNS-Prefetch-Control = "on"

############################
# âœ… STATIC ASSET CACHE
############################
[[headers]]
  for = "/_next/static/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/fonts/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"
    Access-Control-Allow-Origin = "*"
    Content-Type = "font/woff2"

############################
# âœ… XML + RSS
############################
[[headers]]
  for = "/sitemap.xml"
  [headers.values]
    Cache-Control = "public, max-age=86400, must-revalidate"

[[headers]]
  for = "/rss.xml"
  [headers.values]
    Cache-Control = "public, max-age=3600, must-revalidate"

[[headers]]
  for = "/sitemap-blog.xml"
  [headers.values]
    Cache-Control = "public, max-age=86400, must-revalidate"

############################
# âœ… HTML (short cache)
############################
[[headers]]
  for = "/*.html"
  [headers.values]
    Cache-Control = "public, max-age=60, must-revalidate"

############################
# âœ… BLOG PAGES (no cache)
############################
[[headers]]
  for = "/tips/*"
  [headers.values]
    Cache-Control = "no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0"

############################
# âœ… FUNCTIONS CACHE (translate API etc.)
############################
[[headers]]
  for = "/.netlify/functions/translate"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

############################
# âœ… PERFORMANCE OPTIMIZATION
############################
[[headers]]
  for = "/*"
  [headers.values]
    # ðŸ§  wskazÃ³wki dla preconnect (Google Fonts, Analytics)
    Link = "</fonts/poppins/poppins-regular.woff2>; rel=preload; as=font; type=font/woff2; crossorigin=anonymous"
    Timing-Allow-Origin = "*"
    # ðŸ§© Compression
    Content-Encoding = "br"
